<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <title>Tá»‘i Æ°u hÃ³a Server Äa luá»“ng vá»›i mÃ´ hÃ¬nh Thread Pool</title>
</head>
<body>
    <h1>Tá»‘i Æ°u hÃ³a Server Äa luá»“ng vá»›i mÃ´ hÃ¬nh Thread Pool</h1>
    <h2 id="tá»‘i-Æ°u-hÃ³a-server-Ä‘a-luá»“ng-vá»›i-mÃ´-hÃ¬nh-thread-pool">Tá»‘i Æ°u hÃ³a Server Äa luá»“ng vá»›i mÃ´ hÃ¬nh Thread Pool</h2>
<p><img alt="Thread Pool Overview" loading="lazy" src="https://images.viblo.asia/efdf086b-41d8-4d60-b6e8-a94ac6c51db9.png"></p>
<p>Trong cÃ¡c há»‡ thá»‘ng <strong>server hiá»‡n Ä‘áº¡i</strong>, viá»‡c xá»­ lÃ½ Ä‘á»“ng thá»i nhiá»u yÃªu cáº§u tá»« client lÃ  yÃªu cáº§u báº¯t buá»™c. Náº¿u má»—i request táº¡o má»™t luá»“ng (thread) má»›i, server ráº¥t dá»… rÆ¡i vÃ o tÃ¬nh tráº¡ng <strong>quÃ¡ táº£i tÃ i nguyÃªn</strong>, giáº£m hiá»‡u nÄƒng vÃ  tháº­m chÃ­ bá»‹ treo.</p>
<p>MÃ´ hÃ¬nh <strong>Thread Pool</strong> ra Ä‘á»i nháº±m giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch <strong>tÃ¡i sá»­ dá»¥ng cÃ¡c luá»“ng</strong>, giÃºp server hoáº¡t Ä‘á»™ng á»•n Ä‘á»‹nh vÃ  hiá»‡u quáº£ hÆ¡n.</p>
<hr>
<h2 id="khÃ¡i-niá»‡m-thread-pool">KhÃ¡i niá»‡m Thread Pool</h2>
<p><strong>Thread Pool</strong> lÃ  má»™t táº­p há»£p cÃ¡c <strong>thread Ä‘Æ°á»£c táº¡o sáºµn</strong>, luÃ´n á»Ÿ tráº¡ng thÃ¡i chá» Ä‘á»ƒ thá»±c thi cÃ¡c tÃ¡c vá»¥ (task).</p>
<p>Thay vÃ¬:</p>
<ul>
<li>Request â†’ táº¡o thread â†’ xá»­ lÃ½ â†’ há»§y thread</li>
</ul>
<p>Thread Pool hoáº¡t Ä‘á»™ng nhÆ° sau:</p>
<ul>
<li>Request â†’ Ä‘Æ°a vÃ o <strong>hÃ ng Ä‘á»£i (BlockingQueue)</strong></li>
<li>Thread ráº£nh â†’ láº¥y task â†’ xá»­ lÃ½</li>
<li>Xá»­ lÃ½ xong â†’ quay vá» pool</li>
</ul>
<hr>
<h2 id="vÃ¬-sao-khÃ´ng-nÃªn-táº¡o-thread-liÃªn-tá»¥c">VÃ¬ sao khÃ´ng nÃªn táº¡o thread liÃªn tá»¥c?</h2>
<p>Giáº£ sá»­ má»™t Web Server:</p>
<ul>
<li>Má»—i request xá»­ lÃ½ máº¥t 0.5s</li>
<li>100 request Ä‘áº¿n cÃ¹ng lÃºc</li>
<li>10 triá»‡u request / thÃ¡ng</li>
</ul>
<p>ğŸ‘‰ Náº¿u má»—i request táº¡o má»™t thread má»›i:</p>
<ul>
<li>Chi phÃ­ táº¡o thread ráº¥t lá»›n</li>
<li>Tá»‘n bá»™ nhá»› stack</li>
<li>Giáº£m hiá»‡u nÄƒng</li>
<li>Dá»… gÃ¢y <strong>OutOfMemoryError</strong></li>
</ul>
<p>â¡ï¸ <strong>Thread Pool</strong> giÃºp giáº£i quyáº¿t triá»‡t Ä‘á»ƒ váº¥n Ä‘á» nÃ y.</p>
<hr>
<h2 id="cÆ¡-cháº¿-hoáº¡t-Ä‘á»™ng-cá»§a-thread-pool">CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a Thread Pool</h2>
<p><img alt="Thread Pool Queue" loading="lazy" src="https://images.viblo.asia/ef5de1ba-d8c6-480a-866a-1a9d4aca22c4.png"></p>
<p>Cáº¥u trÃºc cÆ¡ báº£n gá»“m:</p>
<ul>
<li><strong>Thread Pool</strong>: táº­p cÃ¡c thread cá»‘ Ä‘á»‹nh</li>
<li><strong>BlockingQueue</strong>: hÃ ng Ä‘á»£i cÃ¡c task</li>
<li><strong>Worker Thread</strong>: láº¥y task ra xá»­ lÃ½</li>
</ul>
<p>Khi sá»‘ request &gt; sá»‘ thread:</p>
<ul>
<li>Request sáº½ <strong>xáº¿p hÃ ng</strong></li>
<li>Äá»£i Ä‘áº¿n khi cÃ³ thread ráº£nh</li>
</ul>
<hr>
<h2 id="executor-trong-java-lÃ -gÃ¬">Executor trong Java lÃ  gÃ¬?</h2>
<p><strong>Executor</strong> lÃ  má»™t thÃ nh pháº§n thuá»™c package <code>java.util.concurrent</code>, chá»‹u trÃ¡ch nhiá»‡m:</p>
<ul>
<li>Quáº£n lÃ½ vÃ²ng Ä‘á»i thread</li>
<li>Láº­p lá»‹ch thá»±c thi task</li>
<li>TÃ¡ch biá»‡t logic xá»­ lÃ½ vÃ  quáº£n lÃ½ thread</li>
</ul>
<p>ğŸ‘‰ Executor Ä‘Ã³ng vai trÃ² nhÆ° <strong>wrapper</strong> cho Thread Pool, giÃºp láº­p trÃ¬nh viÃªn:</p>
<ul>
<li>KhÃ´ng cáº§n tá»± táº¡o thread</li>
<li>KhÃ´ng cáº§n tá»± quáº£n lÃ½ queue</li>
<li>Táº­p trung vÃ o logic nghiá»‡p vá»¥</li>
</ul>
<hr>
<h2 id="cÃ¡c-loáº¡i-thread-pool-trong-java">CÃ¡c loáº¡i Thread Pool trong Java</h2>
<p>Java cung cáº¥p lá»›p tiá»‡n Ã­ch <strong>Executors</strong> Ä‘á»ƒ táº¡o Thread Pool:</p>
<h3 id="-single-thread-executor">ğŸ”¹ Single Thread Executor</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Executors.<span style="color:#a6e22e">newSingleThreadExecutor</span>();
</span></span></code></pre></div>
</body>
</html>
