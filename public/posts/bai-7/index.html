<!DOCTYPE html>
<html>
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8">
    <title>Xá»­ lÃ½ Báº¥t Ä‘á»“ng bá»™ trong JavaScript: Tá»« Callback Ä‘áº¿n Async/Await</title>
</head>
<body>
    <h1>Xá»­ lÃ½ Báº¥t Ä‘á»“ng bá»™ trong JavaScript: Tá»« Callback Ä‘áº¿n Async/Await</h1>
    <blockquote>
<p>âš ï¸ <strong>LÆ°u Ã½</strong>: BÃ i Ä‘Äƒng nÃ y mang tÃ­nh tá»•ng há»£p kiáº¿n thá»©c, luá»“ng kiáº¿n trÃºc vÃ  Ä‘Ã£ khÃ´ng Ä‘Æ°á»£c cáº­p nháº­t trong 3 nÄƒm. Tuy nhiÃªn, <strong>tÆ° duy thiáº¿t káº¿ realtime system vá»›i Socket.IO + Redis váº«n cÃ²n giÃ¡ trá»‹ sá»­ dá»¥ng cao</strong>.</p>
</blockquote>
<hr>
<h2 id="giá»›i-thiá»‡u">Giá»›i thiá»‡u</h2>
<p>ChÃ o cÃ¡c báº¡n ğŸ‘‹<br>
Trong phÃ¡t triá»ƒn á»©ng dá»¥ng <strong>realtime</strong>, Socket.IO lÃ  má»™t trong nhá»¯ng lá»±a chá»n phá»• biáº¿n nháº¥t giÃºp duy trÃ¬ káº¿t ná»‘i hai chiá»u giá»¯a <strong>client</strong> vÃ  <strong>server</strong>.</p>
<p>Nhá» Socket.IO, chÃºng ta cÃ³ thá»ƒ xÃ¢y dá»±ng cÃ¡c á»©ng dá»¥ng:</p>
<ul>
<li>ğŸ’¬ Chat realtime</li>
<li>ğŸ® Game online</li>
<li>ğŸ”” Notification</li>
<li>ğŸ“Š Dashboard realtime</li>
</ul>
<p>BÃ i viáº¿t nÃ y táº­p trung vÃ o:</p>
<ul>
<li>Hiá»ƒu <strong>luá»“ng hoáº¡t Ä‘á»™ng cá»§a Socket.IO</strong></li>
<li>Thiáº¿t káº¿ <strong>há»‡ thá»‘ng chat realtime</strong></li>
<li>Má»Ÿ rá»™ng há»‡ thá»‘ng báº±ng <strong>Redis + Load Balancer</strong></li>
</ul>
<hr>
<h2 id="socketio-lÃ -gÃ¬">Socket.IO lÃ  gÃ¬?</h2>
<p><strong>Socket.IO</strong> lÃ  má»™t thÆ° viá»‡n há»— trá»£ giao tiáº¿p <strong>real-time, hai chiá»u</strong> giá»¯a client (trÃ¬nh duyá»‡t) vÃ  server thÃ´ng qua WebSocket (vÃ  fallback cÆ¡ cháº¿ khÃ¡c).</p>
<p><img alt="Socket.IO Client Server" loading="lazy" src="https://images.viblo.asia/c9b8b962-0a4f-4ef2-b8c2-068c2555ae0d.png"></p>
<h3 id="kiáº¿n-trÃºc-cÆ¡-báº£n">Kiáº¿n trÃºc cÆ¡ báº£n</h3>
<ul>
<li><strong>Client</strong>: Káº¿t ná»‘i lÃªn server qua Socket.IO client</li>
<li><strong>Server</strong>: WebSocket server (thÆ°á»ng dÃ¹ng Node.js)</li>
</ul>
<p>Sau khi handshake thÃ nh cÃ´ng, client vÃ  server cÃ³ thá»ƒ <strong>trao Ä‘á»•i dá»¯ liá»‡u liÃªn tá»¥c</strong>.</p>
<hr>
<h2 id="tÃ­nh-nÄƒng-cÆ¡-báº£n-cá»§a-socketio">TÃ­nh nÄƒng cÆ¡ báº£n cá»§a Socket.IO</h2>
<h3 id="1-giao-tiáº¿p-hai-chiá»u-emit--on">1. Giao tiáº¿p hai chiá»u (emit / on)</h3>
<p>Socket.IO sá»­ dá»¥ng hai khÃ¡i niá»‡m cá»‘t lÃµi:</p>
<ul>
<li><code>emit</code> â†’ phÃ¡t sá»± kiá»‡n</li>
<li><code>on</code> â†’ láº¯ng nghe sá»± kiá»‡n</li>
</ul>
<p>ğŸ“Œ <strong>Client vÃ  server Ä‘á»u cÃ³ thá»ƒ emit &amp; on</strong></p>
<hr>
<h3 id="2-cÃ¡c-kiá»ƒu-emit-trong-socketio">2. CÃ¡c kiá»ƒu emit trong Socket.IO</h3>
<p>Giáº£ sá»­:</p>
<ul>
<li>Server lÃ  WebSocket Server</li>
<li>Socket1, Socket2, Socket3 lÃ  cÃ¡c client</li>
</ul>
<h4 id="-self-emit">ğŸ”¹ Self Emit</h4>
<p>Client gá»­i message â†’ server â†’ tráº£ láº¡i <strong>chÃ­nh client Ä‘Ã³</strong></p>
<p><img alt="Self Emit" loading="lazy" src="https://images.viblo.asia/15e63d2d-7c1f-48b2-851a-e35428ad64c5.png"></p>
<hr>
<h4 id="-broadcast-emit">ğŸ”¹ Broadcast Emit</h4>
<p>Client gá»­i message â†’ server â†’ gá»­i cho <strong>táº¥t cáº£ client khÃ¡c</strong></p>
<p><img alt="Broadcast Emit" loading="lazy" src="https://images.viblo.asia/377c1c84-48fa-4425-81bd-501815540b46.png"></p>
<hr>
<h4 id="-room-emit">ğŸ”¹ Room Emit</h4>
<p>Client gá»­i message â†’ server â†’ gá»­i cho <strong>cÃ¡c client trong cÃ¹ng room</strong></p>
<p><img alt="Room Emit" loading="lazy" src="https://images.viblo.asia/8f950b7e-7c16-40c4-89b8-abb83f39be98.png"></p>
<hr>
<h4 id="-socketid-emit-chat-riÃªng">ğŸ”¹ SocketId Emit (Chat riÃªng)</h4>
<p>Server gá»­i message cho <strong>má»™t client cá»¥ thá»ƒ</strong></p>
<p><img alt="SocketId Emit" loading="lazy" src="https://images.viblo.asia/48f10b6f-45d6-490c-a9d5-7e3efa23d47f.png"></p>
<p>ğŸ“ TÃ i liá»‡u chi tiáº¿t:<br>
<a href="https://socket.io/docs/v3/broadcasting-events/">https://socket.io/docs/v3/broadcasting-events/</a></p>
<hr>
<h2 id="xÃ¢y-dá»±ng-mÃ´-hÃ¬nh-á»©ng-dá»¥ng-chat">XÃ¢y dá»±ng mÃ´ hÃ¬nh á»©ng dá»¥ng chat</h2>
<h3 id="1-quy-mÃ´-nhá»">1ï¸âƒ£ Quy mÃ´ nhá»</h3>
<p>Vá»›i há»‡ thá»‘ng Ã­t ngÆ°á»i dÃ¹ng:</p>
<ul>
<li>1 Web Server</li>
<li>1 WebSocket Server</li>
<li>Client káº¿t ná»‘i trá»±c tiáº¿p</li>
</ul>
<p><img alt="Small Scale" loading="lazy" src="https://images.viblo.asia/9431ec3e-602d-4e93-bd53-30fef9a3a5c5.png"></p>
<p>ğŸ“Œ Má»—i client cÃ³ má»™t <code>socketId</code> riÃªng.</p>
<hr>
<h3 id="2-quy-mÃ´-trung-bÃ¬nh--lá»›n">2ï¸âƒ£ Quy mÃ´ trung bÃ¬nh &amp; lá»›n</h3>
<p>Váº¥n Ä‘á»:</p>
<ul>
<li>Server chá»‹u táº£i tá»‘i Ä‘a ~10K user</li>
<li>LÆ°á»£ng user tÄƒng â†’ server quÃ¡ táº£i â†’ <strong>sáº­p</strong></li>
</ul>
<p>ğŸ‘‰ Giáº£i phÃ¡p:</p>
<ul>
<li><strong>Load Balancer (Nginx)</strong></li>
<li><strong>Redis (Pub/Sub)</strong></li>
</ul>
<hr>
<h2 id="load-balancer-vá»›i-nginx">Load Balancer vá»›i Nginx</h2>
<p>Nginx phÃ¢n phá»‘i request Ä‘áº¿n nhiá»u server Node.js theo <strong>Round Robin</strong>.</p>
<p><img alt="Nginx Load Balance" loading="lazy" src="https://images.viblo.asia/4fed4584-ea7e-4e36-b6a4-fa06950d5ce8.png"></p>
<p>VÃ­ dá»¥:</p>
<ul>
<li>r1 â†’ nodejs:8000</li>
<li>r2 â†’ nodejs:8001</li>
<li>r3 â†’ nodejs:8002</li>
</ul>
<hr>
<h2 id="váº¥n-Ä‘á»-khi-chá»‰-dÃ¹ng-load-balancer">Váº¥n Ä‘á» khi chá»‰ dÃ¹ng Load Balancer</h2>
<p><img alt="Problem Without Redis" loading="lazy" src="https://images.viblo.asia/7da08c2f-92b1-415c-8119-14813a8c2b34.png"></p>
<p>âš ï¸ CÃ¡c WebSocket server <strong>khÃ´ng giao tiáº¿p Ä‘Æ°á»£c vá»›i nhau</strong><br>
â†’ Client á»Ÿ server A khÃ´ng nháº­n Ä‘Æ°á»£c message tá»« client á»Ÿ server B</p>
<p>ğŸ‘‰ <strong>Cáº§n Redis hoáº·c dá»‹ch vá»¥ trung gian</strong></p>
<hr>
<h2 id="redis-pubsub-lÃ -gÃ¬">Redis Pub/Sub lÃ  gÃ¬?</h2>
<p>Redis khÃ´ng chá»‰ lÃ  Key-Value store mÃ  cÃ²n há»— trá»£ <strong>Publish / Subscribe</strong></p>
<ul>
<li><strong>Publish</strong>: Äáº©y message vÃ o channel</li>
<li><strong>Subscribe</strong>: Nháº­n message tá»« channel</li>
</ul>
<p><img alt="Redis Pub Sub" loading="lazy" src="https://images.viblo.asia/67c87ce0-e68e-431c-a71a-8f57bdfbb3da.png"></p>
<p>ğŸ“Œ Redis Ä‘Ã³ng vai trÃ² <strong>message broker</strong></p>
<hr>
<h2 id="kiáº¿n-trÃºc-tá»•ng-thá»ƒ-socketio--redis">Kiáº¿n trÃºc tá»•ng thá»ƒ Socket.IO + Redis</h2>
<p><img alt="Total Architecture" loading="lazy" src="https://images.viblo.asia/c16ce001-ebe6-4529-bf24-901410543261.png"></p>
<h3 id="luá»“ng-hoáº¡t-Ä‘á»™ng">Luá»“ng hoáº¡t Ä‘á»™ng</h3>
<ol>
<li>Client connect WebSocket</li>
<li>Server WebSocket subscribe Redis channel</li>
<li>Redis publish message</li>
<li>Táº¥t cáº£ WebSocket server nháº­n message</li>
<li>Emit xuá»‘ng client tÆ°Æ¡ng á»©ng</li>
</ol>
<p>ğŸ“ Tham kháº£o:
<a href="https://socket.io/docs/v3/using-multiple-nodes/">https://socket.io/docs/v3/using-multiple-nodes/</a></p>
<hr>
<h2 id="á»©ng-dá»¥ng-vá»›i-laravel-broadcasting">á»¨ng dá»¥ng vá»›i Laravel Broadcasting</h2>
<p>Trong Laravel:</p>
<ul>
<li>Redis / Pusher lÃ m broker</li>
<li><code>laravel-echo-server</code> dÃ¹ng Socket.IO</li>
<li><code>laravel-echo</code> dÃ¹ng cho client JS</li>
</ul>
<p>ğŸ“ Docs:
<a href="https://laravel.com/docs/8.x/broadcasting">https://laravel.com/docs/8.x/broadcasting</a></p>
<p>ğŸ“Œ DÃ¹ Node.js hay PHP, <strong>luá»“ng kiáº¿n trÃºc lÃ  nhÆ° nhau</strong></p>
<hr>
<h2 id="káº¿t-luáº­n">Káº¿t luáº­n</h2>
<ul>
<li>Socket.IO giÃºp xÃ¢y dá»±ng realtime application hiá»‡u quáº£</li>
<li>Redis Pub/Sub giáº£i quyáº¿t bÃ i toÃ¡n <strong>scale nhiá»u WebSocket server</strong></li>
<li>Kiáº¿n trÃºc nÃ y phÃ¹ há»£p cho:
<ul>
<li>Chat app</li>
<li>Notification system</li>
<li>Realtime dashboard</li>
</ul>
</li>
</ul>
<p>ğŸ‘‰ Hiá»ƒu <strong>luá»“ng kiáº¿n trÃºc</strong> quan trá»ng hÆ¡n viá»‡c chá»‰ biáº¿t code.</p>
<hr>
<p>ğŸš€ <strong>BÃ i tiáº¿p theo gá»£i Ã½</strong>:</p>
<ul>
<li>So sÃ¡nh Socket.IO vs WebSocket thuáº§n</li>
<li>Redis Streams vs Pub/Sub</li>
<li>Realtime system vá»›i Kafka</li>
</ul>

</body>
</html>
